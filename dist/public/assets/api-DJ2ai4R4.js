function m(e){return e.startsWith("/")?e:`/${e}`}const i={calls:new Map,lastClearTime:Date.now()};function g(e){const r=Date.now();r-i.lastClearTime>36e5&&(i.calls.clear(),i.lastClearTime=r);const o=i.calls.get(e)||0;i.calls.set(e,o+1),o>100&&console.warn(`High API call frequency detected for ${e}: ${o} calls`)}function u(e){if(Array.isArray(e))return e.map(u).filter(r=>r!=null);if(e&&typeof e=="object"){const r={};for(const[o,n]of Object.entries(e)){const s=u(n);s!=null&&!(Array.isArray(s)&&s.length===0)&&!(typeof s=="object"&&Object.keys(s).length===0)&&(r[o]=s)}return r}return e}async function p(e,r="GET",o,n){const s=performance.now(),T=m(e);g(e);const f={method:r,headers:{"Content-Type":"application/json","X-Request-Time":s.toString(),...n==null?void 0:n.headers},credentials:"include",...n};o&&r!=="GET"&&(f.body=JSON.stringify(o));try{const t=await fetch(T,f),c=performance.now()-s;if(t.headers.get("X-Response-Time")&&console.debug(`API ${r} ${e}: ${c.toFixed(2)}ms`),c>2e3&&console.warn(`Slow API request: ${r} ${e} took ${c.toFixed(2)}ms`),!t.ok){const l=await t.text();let a=`HTTP ${t.status}: ${t.statusText}`;try{const y=JSON.parse(l);a=y.error||y.message||a}catch{a=l||a}throw new Error(a)}const w=t.headers.get("content-type");if(w&&w.includes("application/json")){const l=await t.json();return u(l)}return await t.text()}catch(t){const c=performance.now()-s;throw console.error(`API Request Error (${c.toFixed(2)}ms):`,t),t}}export{p as a};
