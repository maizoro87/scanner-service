import{b as O,y as C,j as e,I as R,K as A,M as q,O as T,Q as k,V as D,B as o,J as S,r as N,u as U,m as H,z as J,P,C as b,e as L,a as w,aM as I,f as W,i as F,aa as _,k as G,l as X,aN as Y,g as K,aO as Z,a9 as ee,q as se}from"./index-Cj9AK73v.js";import{S as ae}from"./sidebar-C6JNkD9n.js";import{u as te,F as re,a as h,b as u,c as m,d as j,e as v,z as d,t as le}from"./form-XBVBBCWe.js";import{D as ce,a as ie,b as ne,c as de}from"./dialog-CYYKERfK.js";import{T as oe}from"./textarea-srwHGf3m.js";import{S as xe}from"./switch-BWz5gfAn.js";import{C as he}from"./circle-x-Bs4zksKh.js";import"./api-DJ2ai4R4.js";import"./chart-column-BI2syFgd.js";import"./label-Dfr3Tkin.js";const ue=d.object({name:d.string().min(1,"Name is required"),url:d.string().url("Please enter a valid RSS feed URL"),description:d.string().optional(),category:d.string().min(1,"Category is required"),isActive:d.boolean().default(!0),fetchFrequency:d.number().min(1).max(168).default(24)});function me({open:x,onOpenChange:p}){const{toast:c}=O(),t=te({resolver:le(ue),defaultValues:{name:"",url:"",description:"",category:"",isActive:!0,fetchFrequency:24}}),g=C({mutationFn:async a=>{const r=await fetch("/api/rss-feeds",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error("Failed to create RSS feed");return r.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/rss-feeds"]}),S.invalidateQueries({queryKey:["/api/dashboard/stats"]}),c({title:"Success",description:"RSS feed created successfully"}),p(!1),t.reset()},onError:a=>{c({title:"Error",description:"Failed to create RSS feed",variant:"destructive"})}}),f=a=>{g.mutate(a)},n=["Educational News","EdTech Updates","Teaching Resources","Research & Studies","Policy & Administration","STEM Education","Higher Education","K-12 Education","Special Education","Professional Development","Technology Integration","Other"],y=[{value:1,label:"Every hour"},{value:6,label:"Every 6 hours"},{value:12,label:"Every 12 hours"},{value:24,label:"Daily"},{value:48,label:"Every 2 days"},{value:72,label:"Every 3 days"},{value:168,label:"Weekly"}];return e.jsx(ce,{open:x,onOpenChange:p,children:e.jsxs(ie,{className:"max-w-xl",children:[e.jsx(ne,{children:e.jsx(de,{children:"Add New RSS Feed"})}),e.jsx(re,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(f),className:"space-y-6",children:[e.jsx(h,{control:t.control,name:"name",render:({field:a})=>e.jsxs(u,{children:[e.jsx(m,{children:"Feed Name"}),e.jsx(j,{children:e.jsx(R,{placeholder:"e.g., EdWeek Technology News",...a})}),e.jsx(v,{})]})}),e.jsx(h,{control:t.control,name:"url",render:({field:a})=>e.jsxs(u,{children:[e.jsx(m,{children:"RSS Feed URL"}),e.jsx(j,{children:e.jsx(R,{placeholder:"https://example.com/feed.xml",...a})}),e.jsx(v,{})]})}),e.jsx(h,{control:t.control,name:"description",render:({field:a})=>e.jsxs(u,{children:[e.jsx(m,{children:"Description (Optional)"}),e.jsx(j,{children:e.jsx(oe,{placeholder:"Brief description of what this RSS feed covers...",className:"min-h-[80px]",...a})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{control:t.control,name:"category",render:({field:a})=>e.jsxs(u,{children:[e.jsx(m,{children:"Category"}),e.jsxs(A,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(j,{children:e.jsx(q,{children:e.jsx(T,{placeholder:"Select category"})})}),e.jsx(k,{children:n.map(r=>e.jsx(D,{value:r,children:r},r))})]}),e.jsx(v,{})]})}),e.jsx(h,{control:t.control,name:"fetchFrequency",render:({field:a})=>{var r;return e.jsxs(u,{children:[e.jsx(m,{children:"Fetch Frequency"}),e.jsxs(A,{onValueChange:l=>a.onChange(parseInt(l)),defaultValue:(r=a.value)==null?void 0:r.toString(),children:[e.jsx(j,{children:e.jsx(q,{children:e.jsx(T,{placeholder:"Select frequency"})})}),e.jsx(k,{children:y.map(l=>e.jsx(D,{value:l.value.toString(),children:l.label},l.value))})]}),e.jsx(v,{})]})}})]}),e.jsx(h,{control:t.control,name:"isActive",render:({field:a})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-md border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{className:"text-base",children:"Active Feed"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start fetching content from this RSS feed immediately"})]}),e.jsx(j,{children:e.jsx(xe,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:g.isPending,children:g.isPending?"Creating...":"Create RSS Feed"})]})]})})]})})}function Fe(){const[x,p]=N.useState(""),[c,t]=N.useState(""),[g,f]=N.useState(!1),{toast:n}=O(),{data:y=[],isLoading:a}=U({queryKey:["/api/rss-feeds"]}),r=C({mutationFn:async s=>{if(!(await fetch(`/api/rss-feeds/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete RSS feed")},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/rss-feeds"]}),n({title:"Success",description:"RSS feed deleted successfully"})},onError:()=>{n({title:"Error",description:"Failed to delete RSS feed",variant:"destructive"})}}),l=C({mutationFn:async s=>{const i=await fetch(`/api/rss-feeds/${s}/fetch`,{method:"POST"});if(!i.ok)throw new Error("Failed to fetch RSS feed");return i.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/rss-feeds"]}),n({title:"Success",description:"RSS feed fetch initiated"})},onError:()=>{n({title:"Error",description:"Failed to fetch RSS feed",variant:"destructive"})}}),E=y.filter(s=>{var i;return(s.name.toLowerCase().includes(x.toLowerCase())||((i=s.description)==null?void 0:i.toLowerCase().includes(x.toLowerCase())))&&(c===""||c==="active"&&s.isActive||c==="inactive"&&!s.isActive)}),V=s=>{n({title:"Edit RSS Feed",description:"Edit functionality will be implemented soon",variant:"default"})},z=s=>{confirm(`Are you sure you want to delete "${s.name}"?`)&&r.mutate(s.id)},B=s=>{l.mutate(s.id)},M=s=>{if(!s.isActive)return e.jsx(he,{className:"w-4 h-4 text-gray-500"});switch(s.lastStatus){case"success":return e.jsx(se,{className:"w-4 h-4 text-green-500"});case"error":return e.jsx(ee,{className:"w-4 h-4 text-red-500"});case"manual_fetch_requested":return e.jsx(_,{className:"w-4 h-4 text-blue-500"});default:return e.jsx(Z,{className:"w-4 h-4 text-yellow-500"})}},Q=s=>{if(!s.isActive)return"Inactive";switch(s.lastStatus){case"success":return"Active";case"error":return"Error";case"manual_fetch_requested":return"Fetching";default:return"Pending"}},$=s=>{if(!s.isActive)return"bg-gray-100 text-gray-800";switch(s.lastStatus){case"success":return"bg-green-100 text-green-800";case"error":return"bg-red-100 text-red-800";case"manual_fetch_requested":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}};return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(ae,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(H,{title:"RSS Feeds",breadcrumb:"Content Management / RSS Feeds"}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx(R,{placeholder:"Search RSS feeds...",value:x,onChange:s=>p(s.target.value),className:"pl-10"})]}),e.jsxs("select",{value:c,onChange:s=>t(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md bg-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs(o,{onClick:()=>f(!0),children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add RSS Feed"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a?Array.from({length:6}).map((s,i)=>e.jsxs(b,{className:"animate-pulse",children:[e.jsxs(L,{className:"pb-3",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})})]},i)):E.length===0?e.jsx("div",{className:"col-span-full",children:e.jsx(b,{children:e.jsxs(w,{className:"text-center py-12",children:[e.jsx(I,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg text-gray-500",children:x||c?"No RSS feeds found matching your filters":"No RSS feeds added yet"}),e.jsxs(o,{onClick:()=>f(!0),className:"mt-4",variant:"outline",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Your First RSS Feed"]})]})})}):E.map(s=>e.jsxs(b,{className:"hover:shadow-md transition-shadow",children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(I,{className:"w-4 h-4 text-orange-500"}),e.jsx(W,{className:"text-lg line-clamp-1",children:s.name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:$(s),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[M(s),e.jsx("span",{children:Q(s)})]})}),e.jsx(F,{variant:"outline",className:"text-xs",children:s.category})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>B(s),className:"h-8 w-8 p-0",disabled:l.isPending,children:e.jsx(_,{className:`w-4 h-4 ${l.isPending?"animate-spin":""}`})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>V(),className:"h-8 w-8 p-0",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>z(s),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(X,{className:"w-4 h-4"})})]})]})}),e.jsxs(w,{children:[s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Feed URL"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-3 h-3 text-gray-400"}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 truncate",children:s.url})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Fetch Frequency"}),e.jsxs(F,{variant:"secondary",className:"text-xs",children:["Every ",s.fetchFrequency," hours"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:s.lastFetchedAt?`Last: ${K(new Date(s.lastFetchedAt),{addSuffix:!0})}`:"Never fetched"}),e.jsxs("span",{children:["Added ",K(new Date(s.createdAt),{addSuffix:!0})]})]})]})]},s.id))})]})})]}),e.jsx(me,{open:g,onOpenChange:f})]})}export{Fe as default};
