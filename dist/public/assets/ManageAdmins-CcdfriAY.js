import{c as w,r,j as e,a1 as n,a3 as q,b as E,u as H,y as u,A as z,m as B,C as K,e as U,f as Q,ai as _,B as l,a as I,L as v,i as b,q as N,g as C,I as O,aS as X}from"./index-Cj9AK73v.js";import{L as $}from"./label-Dfr3Tkin.js";import{D as J,a as V,b as G,c as W,i as Y,d as Z}from"./dialog-CYYKERfK.js";import{a as p}from"./api-DJ2ai4R4.js";import{C as ee}from"./circle-x-Bs4zksKh.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=w("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=w("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=w("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),T=r.forwardRef(({className:i,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:n("w-full caption-bottom text-sm",i),...t})}));T.displayName="Table";const A=r.forwardRef(({className:i,...t},a)=>e.jsx("thead",{ref:a,className:n("[&_tr]:border-b",i),...t}));A.displayName="TableHeader";const k=r.forwardRef(({className:i,...t},a)=>e.jsx("tbody",{ref:a,className:n("[&_tr:last-child]:border-0",i),...t}));k.displayName="TableBody";const ie=r.forwardRef(({className:i,...t},a)=>e.jsx("tfoot",{ref:a,className:n("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",i),...t}));ie.displayName="TableFooter";const f=r.forwardRef(({className:i,...t},a)=>e.jsx("tr",{ref:a,className:n("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...t}));f.displayName="TableRow";const d=r.forwardRef(({className:i,...t},a)=>e.jsx("th",{ref:a,className:n("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",i),...t}));d.displayName="TableHead";const c=r.forwardRef(({className:i,...t},a)=>e.jsx("td",{ref:a,className:n("p-4 align-middle [&:has([role=checkbox])]:pr-0",i),...t}));c.displayName="TableCell";const re=r.forwardRef(({className:i,...t},a)=>e.jsx("caption",{ref:a,className:n("mt-4 text-sm text-muted-foreground",i),...t}));re.displayName="TableCaption";function me(){const[i,t]=r.useState(!1),[a,g]=r.useState(""),[x,y]=r.useState(""),h=q(),{toast:o}=E(),{data:S=[],isLoading:P}=H({queryKey:["/api/admin/users"]}),j=u({mutationFn:async s=>{const m=await p("/admin/users",{method:"POST",body:JSON.stringify({email:s})});if(!m||m.error)throw new Error((m==null?void 0:m.error)||"Failed to create admin");return m},onSuccess:s=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),y(s.tempPassword),o({title:"Admin created successfully",description:"Don't forget to share the temporary password"})},onError:s=>{o({title:"Error",description:s.message,variant:"destructive"})}}),R=u({mutationFn:async s=>await p(`/admin/users/${s}/deactivate`,{method:"PUT"}),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),o({title:"Admin deactivated",description:"The admin account has been deactivated"})}}),D=u({mutationFn:async s=>await p(`/admin/users/${s}/activate`,{method:"PUT"}),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),o({title:"Admin activated",description:"The admin account has been activated"})}}),M=u({mutationFn:async s=>await p(`/admin/users/${s}/reset-password`,{method:"POST"}),onSuccess:s=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),y(s.tempPassword),o({title:"Password reset",description:"A new temporary password has been generated"})}}),F=async()=>{a&&await j.mutateAsync(a)},L=async s=>{await navigator.clipboard.writeText(s),o({title:"Copied!",description:"Password copied to clipboard"})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex",children:[e.jsx(z,{}),e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{title:"Manage Admins"}),e.jsx("div",{className:"p-8",children:e.jsxs(K,{children:[e.jsxs(U,{className:"flex flex-row items-center justify-between",children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Admin Users"]}),e.jsxs(l,{onClick:()=>t(!0),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Add Admin"]})]}),e.jsx(I,{children:P?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(v,{className:"h-8 w-8 animate-spin"})}):e.jsxs(T,{children:[e.jsx(A,{children:e.jsxs(f,{children:[e.jsx(d,{children:"Email"}),e.jsx(d,{children:"Role"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Last Login"}),e.jsx(d,{children:"Created"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(k,{children:S.map(s=>e.jsxs(f,{children:[e.jsx(c,{className:"font-medium",children:s.email}),e.jsx(c,{children:e.jsx(b,{variant:s.role==="super_admin"?"default":"secondary",children:s.role==="super_admin"?"Super Admin":"Admin"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.active?e.jsx(N,{className:"h-4 w-4 text-green-500"}):e.jsx(ee,{className:"h-4 w-4 text-red-500"}),s.active?"Active":"Inactive",s.firstLogin&&e.jsx(b,{variant:"outline",className:"ml-2",children:"Pending Setup"})]})}),e.jsx(c,{children:s.lastLogin?C(new Date(s.lastLogin),{addSuffix:!0}):"Never"}),e.jsx(c,{children:C(new Date(s.createdAt),{addSuffix:!0})}),e.jsx(c,{children:e.jsx("div",{className:"flex gap-2",children:s.role!=="super_admin"&&e.jsxs(e.Fragment,{children:[s.active?e.jsx(l,{size:"sm",variant:"outline",onClick:()=>R.mutate(s.id),children:e.jsx(te,{className:"h-4 w-4"})}):e.jsx(l,{size:"sm",variant:"outline",onClick:()=>D.mutate(s.id),children:e.jsx(N,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>M.mutate(s.id),children:e.jsx(se,{className:"h-4 w-4"})})]})})})]},s.id))})]})})]})})]})]}),e.jsx(J,{open:i,onOpenChange:t,children:e.jsxs(V,{children:[e.jsxs(G,{children:[e.jsx(W,{children:"Add New Admin"}),e.jsx(Y,{children:"Create a new admin account. They will need to change their password on first login."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"email",children:"Email Address"}),e.jsx(O,{id:"email",type:"email",placeholder:"admin@example.com",value:a,onChange:s=>g(s.target.value)})]}),x&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Temporary Password:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white px-3 py-1 rounded border flex-1",children:x}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>L(x),children:e.jsx(X,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Share this password securely with the new admin. They must change it on first login."})]})]}),e.jsxs(Z,{children:[e.jsx(l,{variant:"outline",onClick:()=>{t(!1),g(""),y("")},children:"Close"}),!x&&e.jsx(l,{onClick:F,disabled:!a||j.isPending,children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Admin"})]})]})})]})}export{me as default};
